{% extends 'base_public.html' %}

{% block title %}Redeem SB Points{% endblock %}

{% block content %}
<h2>Redeem SB Balance</h2>

<div class="balance-box">
    <p><strong>Your Current Balance:</strong> {{ total_sb }} SB Points</p>
    <p class="info">Equivalent Money: ₹ {{ total_money|floatformat:2 }}</p>
    <p class="info">Minimum Redeemable Amount: ₹ {{ MIN_REDEEM_AMOUNT }}</p>
</div>

<div class="form-box">
    <h3>Submit a Redeem Request</h3>

    {% if error %}
        <p class="error">{{ error }}</p>
    {% endif %}

    <form method="post">
        {% csrf_token %}
        <label for="amount">Amount to Redeem (Money Units):</label>
        <input type="number" name="amount" id="amount" required
               min="{{ MIN_REDEEM_AMOUNT }}"
               max="{{ total_money|floatformat:2 }}"
               step="0.01"
               placeholder="Enter amount to redeem">

        <label for="upi_id">Your UPI ID:</label>
        <input type="text" name="upi_id" id="upi_id" required placeholder="example@upi">

        <button type="submit">Request Redeem</button>
    </form>
</div>

{% if transactions %}
<div class="history-box">
    <h3>Redeem Request History</h3>
    <table border="1" cellpadding="10" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th>Amount (Money)</th>
                <th>SB Points Deducted</th>
                <th>UPI ID</th>
                <th>Status</th>
                <th>Requested At</th>
            </tr>
        </thead>
        <tbody>
            {% for tx in transactions %}
                {% if tx.transaction_type == 'redeem_request' %}
                <tr>
                    <td>{{ tx.display_money|floatformat:2 }}</td>
                    <td>{{ tx.sb_deducted }}</td>
                    <td>{{ tx.upi_id }}</td>
                    <td><span class="status {{ tx.status }}">{{ tx.status|capfirst }}</span></td>
                    <td>{{ tx.timestamp|date:"Y-m-d H:i" }}</td>
                </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}
